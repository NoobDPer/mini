layui.define(["laytpl","laypage","layer","form","util"],function(a){"use strict";var b=layui.$,c=layui.laytpl,d=layui.laypage,e=layui.layer,f=layui.form,h=(layui.util,layui.hint()),i=layui.device(),j={config:{checkName:"LAY_CHECKED",indexName:"LAY_TABLE_INDEX"},cache:{},index:layui.table?layui.table.index+1e4:0,set:function(a){var c=this;return c.config=b.extend({},c.config,a),c},on:function(a,b){return layui.onevent.call(this,n,a,b)}},k=function(){var a=this,b=a.config,c=b.id||b.index;return c&&(k.that[c]=a,k.config[c]=b),{config:b,reload:function(b){a.reload.call(a,b)},setColsWidth:function(){a.setColsWidth.call(a)},resize:function(){a.resize.call(a)}}},l=function(a){var b=k.config[a];return b||h.error("The ID option was not found in the table instance"),b||null},m=function(a,d,e,f){var g=a.templet?function(){return"function"==typeof a.templet?a.templet(e):c(b(a.templet).html()||String(d)).render(e)}():d;return f?b("<div>"+g+"</div>").text():g},n="table",o=".layui-table",r="layui-hide",t="layui-none",u="layui-table-view",v=".layui-table-tool",w=".layui-table-box",x=".layui-table-init",y=".layui-table-header",z=".layui-table-body",A=".layui-table-main",B=".layui-table-fixed",C=".layui-table-fixed-l",D=".layui-table-fixed-r",E=".layui-table-total",F=".layui-table-page",G=".layui-table-sort",H="layui-table-edit",I="layui-table-hover",J=function(a){var b='{{#if(item2.colspan){}} colspan="{{item2.colspan}}"{{#} if(item2.rowspan){}} rowspan="{{item2.rowspan}}"{{#}}}';return a=a||{},['<table cellspacing="0" cellpadding="0" border="0" class="layui-table" ','{{# if(d.data.skin){ }}lay-skin="{{d.data.skin}}"{{# } }} {{# if(d.data.size){ }}lay-size="{{d.data.size}}"{{# } }} {{# if(d.data.even){ }}lay-even{{# } }}>',"<thead>","{{# layui.each(d.data.cols, function(i1, item1){ }}","<tr>","{{# layui.each(item1, function(i2, item2){ }}",'{{# if(item2.fixed && item2.fixed !== "right"){ left = true; } }}','{{# if(item2.fixed === "right"){ right = true; } }}',function(){return a.fixed&&"right"!==a.fixed?'{{# if(item2.fixed && item2.fixed !== "right"){ }}':"right"===a.fixed?'{{# if(item2.fixed === "right"){ }}':""}(),"{{# var isSort = !(item2.colGroup) && item2.sort; }}",'<th data-field="{{ item2.field||i2 }}" data-key="{{d.index}}-{{i1}}-{{i2}}" {{# if( item2.parentKey){ }}data-parentkey="{{ item2.parentKey }}"{{# } }} {{# if(item2.minWidth){ }}data-minwidth="{{item2.minWidth}}"{{# } }} '+b+' {{# if(item2.unresize || item2.colGroup){ }}data-unresize="true"{{# } }} class="{{# if(item2.hide){ }}layui-hide{{# } }}{{# if(isSort){ }} layui-unselect{{# } }}{{# if(!item2.field){ }} layui-table-col-special{{# } }}">','<div class="layui-table-cell laytable-cell-',"{{# if(item2.colGroup){ }}","group","{{# } else { }}","{{d.index}}-{{i1}}-{{i2}}",'{{# if(item2.type !== "normal"){ }}'," laytable-cell-{{ item2.type }}","{{# } }}","{{# } }}",'" {{#if(item2.align){}}align="{{item2.align}}"{{#}}}>','{{# if(item2.type === "checkbox"){ }}','<input type="checkbox" name="layTableCheckbox" lay-skin="primary" lay-filter="layTableAllChoose" {{# if(item2[d.data.checkName]){ }}checked{{# }; }}>',"{{# } else { }}",'<span>{{item2.title||""}}</span>',"{{# if(isSort){ }}",'<span class="layui-table-sort layui-inline"><i class="layui-edge layui-table-sort-asc" title="升序"></i><i class="layui-edge layui-table-sort-desc" title="降序"></i></span>',"{{# } }}","{{# } }}","</div>","</th>",a.fixed?"{{# }; }}":"","{{# }); }}","</tr>","{{# }); }}","</thead>","</table>"].join("")},K=['<table cellspacing="0" cellpadding="0" border="0" class="layui-table" ','{{# if(d.data.skin){ }}lay-skin="{{d.data.skin}}"{{# } }} {{# if(d.data.size){ }}lay-size="{{d.data.size}}"{{# } }} {{# if(d.data.even){ }}lay-even{{# } }}>',"<tbody></tbody>","</table>"].join(""),L=['<div class="layui-form layui-border-box {{d.VIEW_CLASS}}" lay-filter="LAY-table-{{d.index}}" lay-id="{{ d.data.id }}" style="{{# if(d.data.width){ }}width:{{d.data.width}}px;{{# } }} {{# if(d.data.height){ }}height:{{d.data.height}}px;{{# } }}">',"{{# if(d.data.toolbar){ }}",'<div class="layui-table-tool">','<div class="layui-table-tool-temp"></div>','<div class="layui-table-tool-self"></div>',"</div>","{{# } }}",'<div class="layui-table-box">',"{{# if(d.data.loading){ }}",'<div class="layui-table-init" style="background-color: #fff;">','<i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop"></i>',"</div>","{{# } }}","{{# var left, right; }}",'<div class="layui-table-header">',J(),"</div>",'<div class="layui-table-body layui-table-main">',K,"</div>","{{# if(left){ }}",'<div class="layui-table-fixed layui-table-fixed-l">','<div class="layui-table-header">',J({fixed:!0}),"</div>",'<div class="layui-table-body">',K,"</div>","</div>","{{# }; }}","{{# if(right){ }}",'<div class="layui-table-fixed layui-table-fixed-r">','<div class="layui-table-header">',J({fixed:"right"}),'<div class="layui-table-mend"></div>',"</div>",'<div class="layui-table-body">',K,"</div>","</div>","{{# }; }}","</div>","{{# if(d.data.totalRow){ }}",'<div class="layui-table-total">','<table cellspacing="0" cellpadding="0" border="0" class="layui-table" ','{{# if(d.data.skin){ }}lay-skin="{{d.data.skin}}"{{# } }} {{# if(d.data.size){ }}lay-size="{{d.data.size}}"{{# } }} {{# if(d.data.even){ }}lay-even{{# } }}>','<tbody><tr><td><div class="layui-table-cell" style="visibility: hidden;">Total</div></td></tr></tbody>',"</table>","</div>","{{# } }}","{{# if(d.data.page){ }}",'<div class="layui-table-page">','<div id="layui-table-page{{d.index}}"></div>',"</div>","{{# } }}","<style>","{{# layui.each(d.data.cols, function(i1, item1){","layui.each(item1, function(i2, item2){ }}",".laytable-cell-{{d.index}}-{{i1}}-{{i2}}{ ","{{# if(item2.width){ }}","width: {{item2.width}}px;","{{# } }}"," }","{{# });","}); }}","</style>","</div>"].join(""),M=b(window),N=b(document),O=function(a){var c=this;c.index=++j.index,c.config=b.extend({},c.config,j.config,a),c.render()};O.prototype.config={limit:10,loading:!0,cellMinWidth:60,defaultToolbar:["filter","exports","print"],autoSort:!0,text:{none:"无数据"}},O.prototype.render=function(){var f,g,h,i,a=this,d=a.config;return d.elem=b(d.elem),d.where=d.where||{},d.id=d.id||d.elem.attr("id")||a.index,d.request=b.extend({pageName:"page",limitName:"limit"},d.request),d.response=b.extend({statusName:"code",statusCode:0,msgName:"msg",dataName:"data",countName:"count"},d.response),"object"==typeof d.page&&(d.limit=d.page.limit||d.limit,d.limits=d.page.limits||d.limits,a.page=d.page.curr=d.page.curr||1,delete d.page.elem,delete d.page.jump),d.elem[0]?(d.height&&/^full-\d+$/.test(d.height)&&(a.fullHeightGap=d.height.split("-")[1],d.height=M.height()-a.fullHeightGap),a.setInit(),f=d.elem,g=f.next("."+u),h=a.elem=b(c(L).render({VIEW_CLASS:u,data:d,index:a.index})),d.index=a.index,a.key=d.id||d.index,g[0]&&g.remove(),f.after(h),a.layTool=h.find(v),a.layBox=h.find(w),a.layHeader=h.find(y),a.layMain=h.find(A),a.layBody=h.find(z),a.layFixed=h.find(B),a.layFixLeft=h.find(C),a.layFixRight=h.find(D),a.layTotal=h.find(E),a.layPage=h.find(F),a.renderToolbar(),a.fullSize(),d.cols.length>1&&(i=a.layFixed.find(y).find("th"),i.height(a.layHeader.height()-1-parseFloat(i.css("padding-top"))-parseFloat(i.css("padding-bottom")))),e.close(a.tipsIndex),a.pullData(a.page),a.events(),void 0):a},O.prototype.initOpts=function(a){var b=this,d=(b.config,{checkbox:48,radio:48,space:15,numbers:40});a.checkbox&&(a.type="checkbox"),a.space&&(a.type="space"),a.type||(a.type="normal"),"normal"!==a.type&&(a.unresize=!0,a.width=a.width||d[a.type])},O.prototype.setInit=function(a){var b=this,c=b.config;return c.clientWidth=c.width||function(){var a=function(b){var d,e;b=b||c.elem.parent(),d=b.width();try{e="none"===b.css("display")}catch(f){}return!b[0]||d&&!e?d:a(b.parent())};return a()}(),"width"===a?c.clientWidth:(layui.each(c.cols,function(a,d){layui.each(d,function(e,f){if(!f)return d.splice(e,1),void 0;if(f.key=a+"-"+e,f.hide=f.hide||!1,f.colGroup||f.colspan>1){var g=0;layui.each(c.cols[a+1],function(b,c){c.HAS_PARENT||g>1&&g==f.colspan||(c.HAS_PARENT=!0,c.parentKey=a+"-"+e,g+=parseInt(c.colspan>1?c.colspan:1))}),f.colGroup=!0}b.initOpts(f)})}),void 0)},O.prototype.renderToolbar=function(){var g,h,i,a=this,d=a.config,e=['<div class="layui-inline" lay-event="add"><i class="layui-icon layui-icon-add-1"></i></div>','<div class="layui-inline" lay-event="update"><i class="layui-icon layui-icon-edit"></i></div>','<div class="layui-inline" lay-event="delete"><i class="layui-icon layui-icon-delete"></i></div>'].join(""),f=a.layTool.find(".layui-table-tool-temp");"default"===d.toolbar?f.html(e):"string"==typeof d.toolbar&&(g=b(d.toolbar).html()||"",g&&f.html(c(g).render(d))),h={filter:{title:"筛选列",layEvent:"LAYTABLE_COLS",icon:"layui-icon-cols"},exports:{title:"导出",layEvent:"LAYTABLE_EXPORT",icon:"layui-icon-export"},print:{title:"打印",layEvent:"LAYTABLE_PRINT",icon:"layui-icon-print"}},i=[],"object"==typeof d.defaultToolbar&&layui.each(d.defaultToolbar,function(a,b){var c=h[b];c&&i.push('<div class="layui-inline" title="'+c.title+'" lay-event="'+c.layEvent+'">'+'<i class="layui-icon '+c.icon+'"></i>'+"</div>")}),a.layTool.find(".layui-table-tool-self").html(i.join(""))},O.prototype.setParentCol=function(a,b){var g,h,i,c=this,d=c.config,e=c.layHeader.find('th[data-key="'+d.index+"-"+b+'"]'),f=parseInt(e.attr("colspan"))||0;e[0]&&(g=b.split("-"),h=d.cols[g[0]][g[1]],a?f--:f++,e.attr("colspan",f),e[1>f?"addClass":"removeClass"](r),h.colspan=f,h.hide=1>f,i=e.data("parentkey"),i&&c.setParentCol(a,i))},O.prototype.setColsPatch=function(){var a=this,b=a.config;layui.each(b.cols,function(b,c){layui.each(c,function(b,c){c.hide&&a.setParentCol(c.hide,c.parentKey)})})},O.prototype.setColsWidth=function(){var h,i,j,k,l,a=this,b=a.config,c=0,d=0,e=0,f=0,g=a.setInit("width");a.eachCols(function(a,b){b.hide||c++}),g=g-function(){return"line"===b.skin||"nob"===b.skin?2:c+1}()-a.getScrollWidth(a.layMain[0])-1,h=function(a){layui.each(b.cols,function(c,h){layui.each(h,function(c,i){var j=0,k=i.minWidth||b.cellMinWidth;return i?(i.colGroup||i.hide||(a?e&&k>e&&(d--,j=k):(j=i.width||0,/\d+%$/.test(j)?(j=Math.floor(parseFloat(j)/100*g),k>j&&(j=k)):j||(i.width=j=0,d++)),i.hide&&(j=0),f+=j),void 0):(h.splice(c,1),void 0)})}),g>f&&d&&(e=(g-f)/d)},h(),h(!0),a.autoColNums=d,a.eachCols(function(c,d){var f=d.minWidth||b.cellMinWidth;d.colGroup||d.hide||(0===d.width?a.getCssRule(b.index+"-"+d.key,function(a){a.style.width=Math.floor(e>=f?e:f)+"px"}):/\d+%$/.test(d.width)&&a.getCssRule(b.index+"-"+d.key,function(a){a.style.width=Math.floor(parseFloat(d.width)/100*g)+"px"}))}),i=a.layMain.width()-a.getScrollWidth(a.layMain[0])-a.layMain.children("table").outerWidth(),a.autoColNums&&i>=-c&&c>=i&&(j=function(b){var c;return b=b||a.layHeader.eq(0).find("thead th:last-child"),c=b.data("field"),!c&&b.prev()[0]?j(b.prev()):b},k=j(),l=k.data("key"),a.getCssRule(l,function(b){var c=b.style.width||k.outerWidth();b.style.width=parseFloat(c)+i+"px",a.layMain.height()-a.layMain.prop("clientHeight")>0&&(b.style.width=parseFloat(b.style.width)-1+"px")})),a.loading(!0)},O.prototype.resize=function(){var a=this;a.fullSize(),a.setColsWidth(),a.scrollPatch()},O.prototype.reload=function(a){var c=this;a=a||{},delete c.haveInit,a.data&&a.data.constructor===Array&&delete c.config.data,c.config=b.extend(!0,{},c.config,a),c.render()},O.prototype.errorView=function(a){var c=this,d=c.layMain.find("."+t),e=b('<div class="'+t+'">'+(a||"Error")+"</div>");d[0]&&(c.layNone.remove(),d.remove()),c.layFixed.addClass(r),c.layMain.find("tbody").html(""),c.layMain.append(c.layNone=e),j.cache[c.key]=[]},O.prototype.page=1,O.prototype.pullData=function(a){var h,i,j,k,c=this,d=c.config,e=d.request,f=d.response,g=function(){"object"==typeof d.initSort&&c.sort(d.initSort.field,d.initSort.type)};c.startTime=(new Date).getTime(),d.url?(h={},h[e.pageName]=a,h[e.limitName]=d.limit,i=b.extend(h,d.where),d.contentType&&0==d.contentType.indexOf("application/json")&&(i=JSON.stringify(i)),c.loading(),b.ajax({type:d.method||"get",url:d.url,contentType:d.contentType,data:i,dataType:"json",headers:d.headers||{},success:function(b){"function"==typeof d.parseData&&(b=d.parseData(b)||b),b[f.statusName]!=f.statusCode?(c.renderForm(),c.errorView(b[f.msgName]||'返回的数据不符合规范，正确的成功状态码应为："'+f.statusName+'": '+f.statusCode)):(c.renderData(b,a,b[f.countName]),g(),d.time=(new Date).getTime()-c.startTime+" ms"),c.setColsWidth(),"function"==typeof d.done&&d.done(b,a,b[f.countName])},error:function(a,b){c.errorView("数据接口请求异常："+b),c.renderForm(),c.setColsWidth()}})):d.data&&d.data.constructor===Array&&(j={},k=a*d.limit-d.limit,j[f.dataName]=d.data.concat().splice(k,d.limit),j[f.countName]=d.data.length,c.renderData(j,a,j[f.countName]),g(),c.setColsWidth(),"function"==typeof d.done&&d.done(j,a,j[f.countName]))},O.prototype.eachCols=function(a){var b=this;return j.eachCols(null,a,b.config.cols),b},O.prototype.renderData=function(a,f,g,h){var i=this,k=i.config,l=a[k.response.dataName]||[],n=[],o=[],p=[],q=function(){var a;return!h&&i.sortKey?i.sort(i.sortKey.field,i.sortKey.sort,!0):(layui.each(l,function(d,e){var g=[],l=[],q=[],s=d+k.limit*(f-1)+1;0!==e.length&&(h||(e[j.config.indexName]=d),i.eachCols(function(f,h){var p,i=h.field||f,n=k.index+"-"+h.key,o=e[i];(void 0===o||null===o)&&(o=""),h.colGroup||(p=['<td data-field="'+i+'" data-key="'+n+'" '+function(){var a=[];return h.edit&&a.push('data-edit="'+h.edit+'"'),h.align&&a.push('align="'+h.align+'"'),h.templet&&a.push('data-content="'+o+'"'),h.toolbar&&a.push('data-off="true"'),h.event&&a.push('lay-event="'+h.event+'"'),h.style&&a.push('style="'+h.style+'"'),h.minWidth&&a.push('data-minwidth="'+h.minWidth+'"'),a.join(" ")}()+' class="'+function(){var a=[];return h.hide&&a.push(r),h.field||a.push("layui-table-col-special"),a.join(" ")}()+'">','<div class="layui-table-cell laytable-cell-'+function(){return"normal"===h.type?n:n+" laytable-cell-"+h.type}()+'">'+function(){var f=b.extend(!0,{LAY_INDEX:s},e),g=j.config.checkName;switch(h.type){case"checkbox":return'<input type="checkbox" name="layTableCheckbox" lay-skin="primary" '+function(){return h[g]?(e[g]=h[g],h[g]?"checked":""):f[g]?"checked":""}()+">";case"radio":return f[g]&&(a=d),'<input type="radio" name="layTableRadio_'+k.index+'" '+(f[g]?"checked":"")+' lay-type="layTableRadio">';case"numbers":return s}return h.toolbar?c(b(h.toolbar).html()||"").render(f):m(h,o,f)}(),"</div></td>"].join(""),g.push(p),h.fixed&&"right"!==h.fixed&&l.push(p),"right"===h.fixed&&q.push(p))}),n.push('<tr data-index="'+d+'">'+g.join("")+"</tr>"),o.push('<tr data-index="'+d+'">'+l.join("")+"</tr>"),p.push('<tr data-index="'+d+'">'+q.join("")+"</tr>"))}),i.layBody.scrollTop(0),i.layMain.find("."+t).remove(),i.layMain.find("tbody").html(n.join("")),i.layFixLeft.find("tbody").html(o.join("")),i.layFixRight.find("tbody").html(p.join("")),i.renderForm(),"number"==typeof a&&i.setThisRowChecked(a),i.syncCheckAll(),i.haveInit?i.scrollPatch():setTimeout(function(){i.scrollPatch()},50),i.haveInit=!0,e.close(i.tipsIndex),k.HAS_SET_COLS_PATCH||i.setColsPatch(),k.HAS_SET_COLS_PATCH=!0,void 0)};return j.cache[i.key]=l,i.layPage[0==g||0===l.length&&1==f?"addClass":"removeClass"](r),h?q():0===l.length?(i.renderForm(),i.errorView(k.text.none)):(i.layFixed.removeClass(r),q(),i.renderTotal(l),k.page&&(k.page=b.extend({elem:"layui-table-page"+k.index,count:g,limit:k.limit,limits:k.limits||[10,20,30,40,50,60,70,80,90],groups:3,layout:["prev","page","next","skip","count","limit"],prev:'<i class="layui-icon">&#xe603;</i>',next:'<i class="layui-icon">&#xe602;</i>',jump:function(a,b){b||(i.page=a.curr,k.limit=a.limit,i.pullData(a.curr))}},k.page),k.page.count=g,d.render(k.page)),void 0)},O.prototype.renderTotal=function(a){var e,b=this,c=b.config,d={};c.totalRow&&(layui.each(a,function(a,c){0!==c.length&&b.eachCols(function(a,b){var e=b.field||a,f=c[e];b.totalRow&&(d[e]=(d[e]||0)+(parseFloat(f)||0))})}),e=[],b.eachCols(function(a,b){var f=b.field||a,g=['<td data-field="'+f+'" data-key="'+c.index+"-"+b.key+'" '+function(){var a=[];return b.align&&a.push('align="'+b.align+'"'),b.style&&a.push('style="'+b.style+'"'),b.minWidth&&a.push('data-minwidth="'+b.minWidth+'"'),a.join(" ")}()+' class="'+function(){var a=[];return b.hide&&a.push(r),b.field||a.push("layui-table-col-special"),a.join(" ")}()+'">','<div class="layui-table-cell laytable-cell-'+function(){var a=c.index+"-"+b.key;return"normal"===b.type?a:a+" laytable-cell-"+b.type}()+'">'+function(){var a=b.totalRowText||"";return b.totalRow?parseFloat(d[f]).toFixed(2)||a:a}(),"</div></td>"].join("");e.push(g)}),b.layTotal.find("tbody").html("<tr>"+e.join("")+"</tr>"))},O.prototype.getColElem=function(a,b){var c=this,d=c.config;return a.eq(0).find(".laytable-cell-"+(d.index+"-"+b)+":eq(0)")},O.prototype.renderForm=function(a){f.render(a,"LAY-table-"+this.index)},O.prototype.setThisRowChecked=function(a){var b=this,d=(b.config,"layui-table-click"),e=b.layBody.find('tr[data-index="'+a+'"]');e.addClass(d).siblings("tr").removeClass(d)},O.prototype.sort=function(a,c,d,e){var g,o,p,q,f=this,i={},k=f.config,l=k.elem.attr("lay-filter"),m=j.cache[f.key];"string"==typeof a&&f.layHeader.find("th").each(function(){var e=b(this),f=e.data("field");return f===a?(a=e,g=f,!1):void 0});try{if(g=g||a.data("field"),p=a.data("key"),f.sortKey&&!d&&g===f.sortKey.field&&c===f.sortKey.sort)return;q=f.layHeader.find("th .laytable-cell-"+p).find(G),f.layHeader.find("th").find(G).removeAttr("lay-sort"),q.attr("lay-sort",c||null),f.layFixed.find("th")}catch(r){return h.error("Table modules: Did not match to field")}f.sortKey={field:g,sort:c},k.autoSort&&("asc"===c?o=layui.sort(m,g):"desc"===c?o=layui.sort(m,g,!0):(o=layui.sort(m,j.config.indexName),delete f.sortKey)),i[k.response.dataName]=o||m,f.renderData(i,f.page,f.count,!0),e&&layui.event.call(a,n,"sort("+l+")",{field:g,type:c})},O.prototype.loading=function(a){var c=this,d=c.config;d.loading&&(a?(c.layInit&&c.layInit.remove(),delete c.layInit,c.layBox.find(x).remove()):(c.layInit=b(['<div class="layui-table-init">','<i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop"></i>',"</div>"].join("")),c.layBox.append(c.layInit)))},O.prototype.setCheckData=function(a,b){var c=this,d=c.config,e=j.cache[c.key];e[a]&&e[a].constructor!==Array&&(e[a][d.checkName]=b)},O.prototype.syncCheckAll=function(){var a=this,b=a.config,c=a.layHeader.find('input[name="layTableCheckbox"]'),d=function(c){return a.eachCols(function(a,d){"checkbox"===d.type&&(d[b.checkName]=c)}),c};c[0]&&(j.checkStatus(a.key).isAll?(c[0].checked||(c.prop("checked",!0),a.renderForm("checkbox")),d(!0)):(c[0].checked&&(c.prop("checked",!1),a.renderForm("checkbox")),d(!1)))},O.prototype.getCssRule=function(a,b){var c=this,d=c.elem.find("style")[0],e=d.sheet||d.styleSheet||{},f=e.cssRules||e.rules;layui.each(f,function(c,d){return d.selectorText===".laytable-cell-"+a?(b(d),!0):void 0})},O.prototype.fullSize=function(){var d,a=this,b=a.config,c=b.height;a.fullHeightGap&&(c=M.height()-a.fullHeightGap,135>c&&(c=135),a.elem.css("height",c)),c&&(d=parseFloat(c)-(a.layHeader.outerHeight()||38),b.toolbar&&(d-=a.layTool.outerHeight()||50),b.totalRow&&(d-=a.layTotal.outerHeight()||40),b.page&&(d-=a.layPage.outerHeight()||41),a.layMain.css("height",d-2))},O.prototype.getScrollWidth=function(a){var b=0;return a?b=a.offsetWidth-a.clientWidth:(a=document.createElement("div"),a.style.width="100px",a.style.height="100px",a.style.overflowY="scroll",document.body.appendChild(a),b=a.offsetWidth-a.clientWidth,document.body.removeChild(a)),b},O.prototype.scrollPatch=function(){var i,j,a=this,c=a.layMain.children("table"),d=a.layMain.width()-a.layMain.prop("clientWidth"),e=a.layMain.height()-a.layMain.prop("clientHeight"),g=(a.getScrollWidth(a.layMain[0]),c.outerWidth()-a.layMain.width()),h=function(a){if(d&&e){if(a=a.eq(0),!a.find(".layui-table-patch")[0]){var c=b('<th class="layui-table-patch"><div class="layui-table-cell"></div></th>');c.find("div").css({width:d}),a.find("tr").append(c)}}else a.find(".layui-table-patch").remove()};h(a.layHeader),h(a.layTotal),i=a.layMain.height(),j=i-e,a.layFixed.find(z).css("height",c.height()>=j?j:"auto"),a.layFixRight[g>0?"removeClass":"addClass"](r),a.layFixRight.css("right",d-1)},O.prototype.events=function(){var l,p,q,t,v,a=this,d=a.config,g=b("body"),h={},k=a.layHeader.find("th"),m=".layui-table-cell",o=d.elem.attr("lay-filter");a.layTool.on("click","*[lay-event]",function(c){var l,m,p,g=b(this),h=g.attr("lay-event"),k=function(c){var e=b(c.list),f=b('<ul class="layui-table-tool-panel"></ul>');f.html(e),d.height&&f.css("max-height",d.height-(a.layTool.outerHeight()||50)),g.find(".layui-table-tool-panel")[0]||g.append(f),a.renderForm(),f.on("click",function(a){layui.stope(a)}),c.done&&c.done(f,e)};switch(layui.stope(c),N.trigger("table.tool.panel.remove"),e.close(a.tipsIndex),h){case"LAYTABLE_COLS":k({list:function(){var b=[];return a.eachCols(function(a,c){c.field&&"normal"==c.type&&b.push('<li><input type="checkbox" name="'+c.field+'" data-key="'+c.key+'" data-parentkey="'+(c.parentKey||"")+'" lay-skin="primary" '+(c.hide?"":"checked")+' title="'+(c.title||c.field)+'" lay-filter="LAY_TABLE_TOOL_COLS"></li>')}),b.join("")}(),done:function(){f.on("checkbox(LAY_TABLE_TOOL_COLS)",function(c){var e=b(c.elem),f=this.checked,g=e.data("key"),h=e.data("parentkey");layui.each(d.cols,function(b,c){layui.each(c,function(c,e){if(b+"-"+c===g){var i=e.hide;e.hide=!f,a.elem.find('*[data-key="'+d.index+"-"+g+'"]')[f?"removeClass":"addClass"](r),i!=e.hide&&a.setParentCol(!f,h),a.resize()}})})})}});break;case"LAYTABLE_EXPORT":i.ie?e.tips("导出功能不支持 IE，请用 Chrome 等高级浏览器导出",this,{tips:3}):k({list:function(){return['<li data-type="csv">导出到 Csv 文件</li>','<li data-type="xls">导出到 Excel 文件</li>'].join("")}(),done:function(a,c){c.on("click",function(){var a=b(this).data("type");j.exportFile(d.id,null,a)})}});break;case"LAYTABLE_PRINT":l=window.open("打印窗口","_blank"),m=["<style>","body{font-size: 12px; color: #666;}","table{width: 100%; border-collapse: collapse; border-spacing: 0;}","th,td{line-height: 20px; padding: 9px 15px; border: 1px solid #ccc; text-align: left; font-size: 12px; color: #666;}","a{color: #666; text-decoration:none;}","*.layui-hide{display: none}","</style>"].join(""),p=b(a.layHeader.html()),p.append(a.layMain.find("table").html()),p.append(a.layTotal.find("table").html()),p.find("th.layui-table-patch").remove(),p.find(".layui-table-col-special").remove(),l.document.write(m+p.prop("outerHTML")),l.document.close(),l.print(),l.close()}layui.event.call(this,n,"toolbar("+o+")",b.extend({event:h,config:d},{}))}),k.on("mousemove",function(a){var c=b(this),d=c.offset().left,e=a.clientX-d;c.data("unresize")||h.resizeStart||(h.allowResize=c.width()-e<=10,g.css("cursor",h.allowResize?"col-resize":""))}).on("mouseleave",function(){b(this),h.resizeStart||g.css("cursor","")}).on("mousedown",function(c){var f,e=b(this);h.allowResize&&(f=e.data("key"),c.preventDefault(),h.resizeStart=!0,h.offset=[c.clientX,c.clientY],a.getCssRule(f,function(a){var b=a.style.width||e.outerWidth();h.rule=a,h.ruleWidth=parseFloat(b),h.minWidth=e.data("minwidth")||d.cellMinWidth}))}),N.on("mousemove",function(b){if(h.resizeStart){if(b.preventDefault(),h.rule){var c=h.ruleWidth+b.clientX-h.offset[0];c<h.minWidth&&(c=h.minWidth),h.rule.style.width=c+"px",e.close(a.tipsIndex)}l=1}}).on("mouseup",function(){h.resizeStart&&(h={},g.css("cursor",""),a.scrollPatch()),2===l&&(l=null)}),k.on("click",function(){var g,d=b(this),e=d.find(G),f=e.attr("lay-sort");return e[0]&&1!==l?(g="asc"===f?"desc":"desc"===f?null:"asc",a.sort(d,g,null,!0),void 0):l=2}).find(G+" .layui-edge ").on("click",function(c){var d=b(this),e=d.index(),f=d.parents("th").eq(0).data("field");layui.stope(c),0===e?a.sort(f,"asc",null,!0):a.sort(f,"desc",null,!0)}),p=function(d){var e=b(this),f=e.parents("tr").eq(0).data("index"),g=a.layBody.find('tr[data-index="'+f+'"]'),h=j.cache[a.key]||[];return h=h[f]||{},b.extend({tr:g,data:j.clearCacheKey(h),del:function(){j.cache[a.key][f]=[],g.remove(),a.scrollPatch()},update:function(d){d=d||{},layui.each(d,function(d,e){if(d in h){var f,i=g.children('td[data-field="'+d+'"]');h[d]=e,a.eachCols(function(a,b){b.field==d&&b.templet&&(f=b.templet)}),i.children(m).html(function(){return f?function(){return"function"==typeof f?f(h):c(b(f).html()||e).render(h)}():e}()),i.data("content",e)}})}},d)},a.elem.on("click",'input[name="layTableCheckbox"]+',function(){var c=b(this).prev(),d=a.layBody.find('input[name="layTableCheckbox"]'),e=c.parents("tr").eq(0).data("index"),f=c[0].checked,g="layTableAllChoose"===c.attr("lay-filter");g?(d.each(function(b,c){c.checked=f,a.setCheckData(b,f)}),a.syncCheckAll(),a.renderForm("checkbox")):(a.setCheckData(e,f),a.syncCheckAll()),layui.event.call(c[0],n,"checkbox("+o+")",p.call(c[0],{checked:f,type:g?"all":"one"}))}),a.elem.on("click",'input[lay-type="layTableRadio"]+',function(){var c=b(this).prev(),d=c[0].checked,e=j.cache[a.key],f=c.parents("tr").eq(0).data("index");layui.each(e,function(a,b){f===a?b.LAY_CHECKED=!0:delete b.LAY_CHECKED}),a.setThisRowChecked(f),layui.event.call(this,n,"radio("+o+")",p.call(this,{checked:d}))}),a.layBody.on("mouseenter","tr",function(){var c=b(this),d=c.index();c.data("off")||a.layBody.find("tr:eq("+d+")").addClass(I)}).on("mouseleave","tr",function(){var c=b(this),d=c.index();c.data("off")||a.layBody.find("tr:eq("+d+")").removeClass(I)}).on("click","tr",function(){q.call(this,"row")}).on("dblclick","tr",function(){q.call(this,"rowDouble")}),q=function(a){var c=b(this);c.data("off")||layui.event.call(this,n,a+"("+o+")",p.call(c.children("td")[0]))},a.layBody.on("change","."+H,function(){var c=b(this),d=this.value,e=c.parent().data("field"),f=c.parents("tr").eq(0).data("index"),g=j.cache[a.key][f];g[e]=d,layui.event.call(this,n,"edit("+o+")",p.call(this,{value:d,field:e}))}).on("blur","."+H,function(){var d,e=b(this),f=this,g=e.parent().data("field"),h=e.parents("tr").eq(0).data("index"),i=j.cache[a.key][h];a.eachCols(function(a,b){b.field==g&&b.templet&&(d=b.templet)}),e.siblings(m).html(function(a){return d?function(){return"function"==typeof d?d(i):c(b(d).html()||f.value).render(i)}():a}(f.value)),e.parent().data("content",f.value),e.remove()}),a.layBody.on("click","td",function(a){var g,c=b(this),e=(c.data("field"),c.data("edit")),f=c.children(m);if(!c.data("off"))return e?(g=b('<input class="layui-input '+H+'">'),g[0].value=c.data("content")||f.text(),c.find("."+H)[0]||c.append(g),g.focus(),layui.stope(a),void 0):void 0}).on("mouseenter","td",function(){v.call(this)}).on("mouseleave","td",function(){v.call(this,"hide")}),t="layui-table-grid-down",v=function(a){var c=b(this),d=c.children(m);if(!c.data("off"))if(a)c.find(".layui-table-grid-down").remove();else if(d.prop("scrollWidth")>d.outerWidth()){if(d.find("."+t)[0])return;c.append('<div class="'+t+'"><i class="layui-icon layui-icon-down"></i></div>')}},a.layBody.on("click","."+t,function(c){var f=b(this),g=f.parent(),h=g.children(m);a.tipsIndex=e.tips(['<div class="layui-table-tips-main" style="margin-top: -'+(h.height()+16)+"px;"+function(){return"sm"===d.size?"padding: 4px 15px; font-size: 12px;":"lg"===d.size?"padding: 14px 15px;":""}()+'">',h.html(),"</div>",'<i class="layui-icon layui-table-tips-c layui-icon-close"></i>'].join(""),h[0],{tips:[3,""],time:-1,anim:-1,maxWidth:i.ios||i.android?300:a.elem.width()/2,isOutAnim:!1,skin:"layui-table-tips",success:function(a,b){a.find(".layui-table-tips-c").on("click",function(){e.close(b)})}}),layui.stope(c)}),a.layBody.on("click","*[lay-event]",function(){var c=b(this),d=c.parents("tr").eq(0).data("index");layui.event.call(this,n,"tool("+o+")",p.call(this,{event:c.attr("lay-event")})),a.setThisRowChecked(d)}),a.layMain.on("scroll",function(){var c=b(this),d=c.scrollLeft(),f=c.scrollTop();a.layHeader.scrollLeft(d),a.layTotal.scrollLeft(d),a.layFixed.find(z).scrollTop(f),e.close(a.tipsIndex)}),N.on("click",function(){N.trigger("table.remove.tool.panel")}),N.on("table.remove.tool.panel",function(){b(".layui-table-tool-panel").remove()}),M.on("resize",function(){a.resize()})},j.init=function(a,c){c=c||{};var d=this,e=a?b('table[lay-filter="'+a+'"]'):b(o+"[lay-data]"),f="Table element property lay-data configuration item has a syntax error: ";return e.each(function(){var i,k,d=b(this),e=d.attr("lay-data");try{e=new Function("return "+e)()}catch(g){h.error(f+e)}i=[],k=b.extend({elem:this,cols:[],data:[],skin:d.attr("lay-skin"),size:d.attr("lay-size"),even:"string"==typeof d.attr("lay-even")},j.config,c,e),a&&d.hide(),d.find("thead>tr").each(function(a){k.cols[a]=[],b(this).children().each(function(){var j,d=b(this),e=d.attr("lay-data");try{e=new Function("return "+e)()}catch(g){return h.error(f+e)}j=b.extend({title:d.text(),colspan:d.attr("colspan")||0,rowspan:d.attr("rowspan")||0},e),j.colspan<2&&i.push(j),k.cols[a].push(j)})}),d.find("tbody>tr").each(function(a){var c=b(this),d={};c.children("td").each(function(){var e=b(this),f=e.data("field");return f?d[f]=e.html():void 0}),layui.each(i,function(a,b){var e=c.children("td").eq(a);d[b.field]=e.html()}),k.data[a]=d}),j.render(k)}),d},k.that={},k.config={},j.eachCols=function(a,c,d){var h,e=k.config[a]||{},f=[],g=0;d=b.extend(!0,[],d||e.cols),layui.each(d,function(a,b){layui.each(b,function(b,c){if(c.colGroup){var e=0;g++,c.CHILD_COLS=[],layui.each(d[a+1],function(a,b){b.PARENT_COL_INDEX||e>1&&e==c.colspan||(b.PARENT_COL_INDEX=g,c.CHILD_COLS.push(b),e+=parseInt(b.colspan>1?b.colspan:1))})}c.PARENT_COL_INDEX||f.push(c)})}),h=function(a){layui.each(a||f,function(a,b){return b.CHILD_COLS?h(b.CHILD_COLS):("function"==typeof c&&c(a,b),void 0)})},h()},j.checkStatus=function(a){var b=0,c=0,d=[],e=j.cache[a]||[];return layui.each(e,function(a,e){return e.constructor===Array?(c++,void 0):(e[j.config.checkName]&&(b++,d.push(j.clearCacheKey(e))),void 0)}),{data:d,isAll:e.length?b===e.length-c:!1}},j.exportFile=function(a,b,c){b=b||j.clearCacheKey(j.cache[a]),c=c||"csv";var d=k.config[a]||{},e={csv:"text/csv",xls:"application/vnd.ms-excel"}[c],f=document.createElement("a");return i.ie?h.error("IE_NOT_SUPPORT_EXPORTS"):(f.href="data:"+e+";charset=utf-8,﻿"+encodeURIComponent(function(){var c=[],d=[];return layui.each(b,function(b,e){var f=[];"object"==typeof a?(layui.each(a,function(a,d){0==b&&c.push(d||"")}),layui.each(j.clearCacheKey(e),function(a,b){f.push('"'+(b||"")+'"')})):j.eachCols(a,function(a,d){d.field&&"normal"==d.type&&!d.hide&&(0==b&&c.push(d.title||""),f.push('"'+m(d,e[d.field],e,"text")+'"'))}),d.push(f.join(","))}),c.join(",")+"\r\n"+d.join("\r\n")}()),f.download=(d.title||"table_"+(d.index||""))+"."+c,document.body.appendChild(f),f.click(),document.body.removeChild(f),void 0)},j.resize=function(a){if(a){var b=l(a);if(!b)return;k.that[a].resize()}else layui.each(k.that,function(){this.resize()})},j.reload=function(a,b){var d,c=l(a);if(c)return d=k.that[a],d.reload(b),k.call(d)},j.render=function(a){var b=new O(a);return k.call(b)},j.clearCacheKey=function(a){return a=b.extend({},a),delete a[j.config.checkName],delete a[j.config.indexName],a},j.init(),a(n,j)});